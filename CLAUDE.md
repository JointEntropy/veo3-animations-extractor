# Veo3 Animation Extractor

## Project Overview

This project is a post-processing pipeline for converting AI-generated character animations into production-ready sprite sheets. It is part of a larger workflow for automatic sprite sheet generation based on AI, specifically handling the post-processing stage.

**Input:** MP4 video files generated by Veo3 (Google's video generation model)
**Output:** Production-ready animation spritesheets with transparent backgrounds

## Purpose

Veo3 generates character animations as standard MP4 video files. This tool performs the necessary post-processing to extract game-ready sprite sheets:

1. Extract specific animation regions from video grid cells (e.g., JUMP, IDLE, STUNNED animations)
2. Convert video segments into individual frames
3. Remove backgrounds by subtraction to achieve transparency
4. Combine frames into standard spritesheet grids

## Target Audience

Currently an internal tool for personal use. Future potential audience includes solo developers and small indie game teams looking to leverage AI-generated animations.

## Technical Architecture

### Pipeline Components

**Entry Point:** `extract_from_veo.sh`
- Configuration file defining specific animations to extract
- Sets crop parameters (offset X/Y, width/height) for each animation grid cell
- Currently implements JUMP animation extraction
- Placeholder TODOs for IDLE and STUNNED animations

**Core Pipeline:** `scripts/pipeline.sh`
- Generic video processing pipeline
- Three-stage FFmpeg-based processing
- Reusable for any animation type with different crop parameters

### Processing Stages

#### Stage 1: Video Region Extraction
- Crops specific rectangular region from input MP4
- Configured via offset (X, Y) and dimensions (width, height)
- Time-based truncation (start/end timestamps)
- Uses FFmpeg crop filter with optional re-encoding

#### Stage 2: Frame Extraction
- Converts cropped video into individual PNG frames
- Standardizes to 256x256 pixels per frame
- Maintains aspect ratio with padding
- Outputs to `processing_{name}/frames/` directory

#### Stage 3: Spritesheet Generation
- Combines frames into 2048x2048 grid
- 8x8 layout (64 frames maximum per sheet)
- Uses FFmpeg tile filter
- Single PNG output file

### Current Configuration Example (JUMP Animation)

```bash
OFFSET_X=28        # Horizontal position of animation cell in grid
OFFSET_Y=218       # Vertical position of animation cell in grid
WIDTH=605          # Width of animation cell
HEIGHT=605         # Height of animation cell
ANIMATION_NAME=JUMP
Time Range: 00:00:00 to 00:00:04
```

## Directory Structure

```
veo3-animation-extractor/
├── extract_from_veo.sh          # Main entry point, animation configs
├── scripts/
│   └── pipeline.sh               # Core processing pipeline
├── examples/
│   └── input.mp4                 # Sample Veo3 generated video
├── processing_{name}/            # Output directory (created during processing)
│   ├── frames/                   # Individual extracted frames
│   ├── {name}_truncated.mp4     # Intermediate cropped video
│   └── {name}_spritesheet.png   # Final spritesheet output
└── README.md                     # User documentation
```

## Dependencies

- **FFmpeg:** Required for all video/image processing operations
- Handles video cropping, frame extraction, scaling, and tiling

## Output Specifications

- **Frame Size:** 256x256 pixels (scaled with aspect ratio preservation)
- **Spritesheet Size:** 2048x2048 pixels
- **Grid Layout:** 8 rows × 8 columns
- **Maximum Frames:** 64 per spritesheet
- **Format:** PNG with transparency support

## Workflow Example

To extract a JUMP animation from a Veo3-generated video:

```bash
./extract_from_veo.sh
```

This internally calls:

```bash
./scripts/pipeline.sh examples/input.mp4 00:00:00 00:00:04 JUMP "605:605:28:218"
```

Result: `processing_JUMP/JUMP_spritesheet.png` containing 8x8 grid of animation frames

## Key Features

1. **Precise Grid Cell Extraction:** Pixel-perfect cropping of animation regions from Veo3's multi-animation grid layout
2. **Standardized Output:** Consistent 256×256 frame size for game engine compatibility
3. **Spritesheet Grid Generation:** Industry-standard 8×8 layout at 2048×2048 resolution
4. **Background Removal:** Capability to subtract backgrounds for transparent sprite sheets
5. **Time-based Selection:** Extract specific time ranges from longer animations
6. **Batch Processing Ready:** Structured for processing multiple animation types from same source video

## Current Status

**Implemented:**
- Complete pipeline infrastructure
- JUMP animation extraction and spritesheet generation
- Flexible crop parameter system

**Planned (TODO):**
- IDLE animation extraction configuration
- STUNNED animation extraction configuration
- Additional animation states as needed

## Development Notes

- Tool is designed for internal use with potential future expansion
- Pipeline script (`pipeline.sh`) is generic and reusable
- Animation-specific configuration happens in `extract_from_veo.sh`
- Each animation type requires manual determination of grid cell coordinates from Veo3 output
- Background subtraction logic is mentioned but implementation details TBD

## Technical Constraints

- Maximum 64 frames per spritesheet (8×8 grid)
- Videos with more frames will be truncated with warning
- Crop coordinates must be determined manually by inspecting Veo3 grid layout
- Processing creates temporary directories that persist after completion

## Future Considerations

While not actively planned, potential enhancements could include:
- Automatic grid cell detection
- Support for different spritesheet sizes/layouts
- Batch processing multiple animations in one command
- Background subtraction automation
- Preview/validation tools for crop parameters
